# Explore With Me - Микросервисная архитектура приложения

## Описание проекта

Приложение "Explore With Me" представляет собой платформу для организации и поиска событий. Проект реализован в виде микросервисной архитектуры, где каждый функциональный компонент выделен в отдельный сервис с четкой ответственностью.

## Архитектура приложения

### Сервисы

Проект состоит из следующих микросервисов, расположенных в соответствующих директориях:

**Модуль core**:
- **category-service** - управление категориями событий
- **comment-service** - управление комментариями к событиям
- **compilation-service** - управление подборками событий
- **event-service** - управление событиями
- **request-service** - управление запросами на участие в событиях
- **user-service** - управление пользователями

**Дополнительные модули**:
- **stats** - модуль статистики для сбора и анализа просмотров событий

**Инфраструктурные компоненты (infra)**:
- **discovery-server** - сервер обнаружения сервисов на базе Eureka
- **config-server** - централизованный сервер конфигураций
- **gateway-server** - API шлюз для маршрутизации запросов

### Взаимодействие между сервисами

Сервисы взаимодействуют друг с другом через REST API с использованием Spring Cloud. Архитектура включает следующие компоненты:

1. **API Gateway (gateway-server)** - централизованная точка входа для всех клиентских запросов
2. **Service Discovery (discovery-server)** - регистрация и обнаружение сервисов
3. **Configuration Server (config-server)** - централизованное управление конфигурациями

Механизм взаимодействия:
- Клиентские запросы поступают в gateway-server
- Gateway перенаправляет запросы к соответствующим микросервисам
- Сервисы регистрируются в discovery-server и обнаруживают друг друга через него
- Все сервисы получают свои конфигурации из config-server

### Конфигурации

Конфигурации сервисов находятся в следующих местах:

- **Конфигурации микросервисов**: `/infra/config-server/`
  - Каждый сервис имеет свою директорию с конфигурационными файлами
  - Основной файл конфигурации: `application.yml`

- **Конфигурации инфраструктурных компонентов**:
  - в соответствующих поддиректориях `infra/`

- **Docker-конфигурация**: `docker-compose.yml`
  - Определяет все сервисы, их зависимости и настройки контейнеров

## Внутренний API для взаимодействия сервисов

Сервисы взаимодействуют друг с другом через HTTP-запросы. Основные точки взаимодействия:

1. **event-service** взаимодействует с:
   - category-service (для получения информации о категориях)
   - user-service (для получения информации об инициаторах событий)
   - request-service (для управления заявками на участие)

2. **comment-service** взаимодействует с:
   - event-service (для проверки существования событий)
   - user-service (для проверки существования пользователей)

3. **request-service** взаимодействует с:
   - event-service (для проверки событий и ограничений участия)
   - user-service (для проверки пользователей)

4. **compilation-service** взаимодействует с:
   - event-service (для получения событий, включенных в подборки)

Все внутренние вызовы осуществляются через Feign-клиенты, определенные в соответствующих сервисах.

## Внешнее API

Внешний API приложения предоставляет функциональность через API Gateway на порту 8080. Доступные эндпоинты сгруппированы по типам доступа:

### Публичные API (доступны всем)

**Категории**:
- `GET /categories` - получение списка категорий
- `GET /categories/{catId}` - получение категории по идентификатору

**События**:
- `GET /events` - получение событий с фильтрацией
- `GET /events/{id}` - получение подробной информации о событии

**Подборки событий**:
- `GET /compilations` - получение подборок событий
- `GET /compilations/{compId}` - получение подборки по идентификатору

### Закрытые API (требуют аутентификации)

**Пользователи**:
- `GET /users/{userId}` - получение информации о пользователе
- `POST /users` - регистрация пользователя

**События**:
- `POST /users/{userId}/events` - создание события
- `GET /users/{userId}/events` - получение событий пользователя
- `PATCH /users/{userId}/events/{eventId}` - редактирование события

**Запросы на участие**:
- `POST /users/{userId}/requests?eventId={eventId}` - создание запроса на участие
- `GET /users/{userId}/requests` - получение запросов пользователя
- `PATCH /users/{userId}/requests/{requestId}/cancel` - отмена запроса

**Комментарии**:
- `POST /users/{userId}/events/{eventId}/comments` - создание комментария
- `GET /users/{userId}/events/{eventId}/comments` - получение комментариев события

### Административные API

**Пользователи**:
- `GET /admin/users` - получение всех пользователей
- `POST /admin/users` - создание пользователя
- `DELETE /admin/users/{userId}` - удаление пользователя

**Категории**:
- `POST /admin/categories` - создание категории
- `PATCH /admin/categories/{catId}` - редактирование категории
- `DELETE /admin/categories/{catId}` - удаление категории

**События**:
- `GET /admin/events` - получение всех событий
- `PATCH /admin/events/{eventId}` - редактирование события (публикация/отклонение)

**Подборки**:
- `POST /admin/compilations` - создание подборки
- `PATCH /admin/compilations/{compId}` - редактирование подборки
- `DELETE /admin/compilations/{compId}` - удаление подборки

## Запуск приложения

Для запуска приложения используйте Docker Compose:
```
docker-compose up -d
```

Все сервисы будут автоматически зарегистрированы в Eureka и получат свои конфигурации из Config Server.

## Документация API

Полная спецификация API доступна в файлах:
- `ewm-main-service-spec.json` - основная спецификация
- `ewm-stats-service-spec.json` - спецификация сервиса статистики

Также документация доступна в формате OpenAPI после запуска приложения.